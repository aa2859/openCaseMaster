@using openCaseMaster.Models;
@using openCaseMaster.helper;

@model M_testCase
 <input type="hidden" value="@Model.ID" />
<div class="easyui-panel" style="margin-bottom:5px">
    <a href="javascript:void(0)" id="mb" class="easyui-menubutton" style="width:100px"
       data-options="menu:'#C1',iconCls:'icon-edit'">编辑</a>
    <div id="C1" style="width:150px;">
        <div data-options="iconCls:'icon-save'" onclick="caseViewSave();">保存</div>
        <div class="menu-sep"></div>
        <div data-options="iconCls:'icon-add'">
            <span>新增步骤</span>
            <div>
                <div>上一步</div>
                <div>下一步</div>
            </div>
        </div>
        <div data-options="iconCls:'icon-remove'" onclick="DeleteCase();">删除节点</div>
    </div>
    <a href="javascript:void(0)" id="mb" class="easyui-menubutton" style="width:100px"
       data-options="menu:'#C2',iconCls:'icon-ok'">操作</a>
    <div id="C2" style="width:150px;">
        <div data-options="iconCls:'icon-box_add'" onclick="">自定义组件</div>
        <div class="menu-sep"></div>
        <div data-options="iconCls:'icon-media_controls_dark_play'" onclick="">执行案例</div>
        
     
    </div>
</div>

<ul id="caseViewTree"></ul>

<script type="text/javascript">
    //@@ sourceURL=caseview.js
    var data = @Html.Raw(Model.getCaseTree2Json());
    $('#caseViewTree').tree({
        data:data,
        dnd:true,
        checkbox:true,
        pointType:["top","top","bottom","bottom"],
        animate:true,
        lines:true,
        onLoadSuccess:function(node, data){
            var nodes = $('#caseViewTree').tree("getRoots")
            $(nodes).each(function()
            {
                $($("#caseViewTree").tree("getChildren",this.target)).each(function(){
                    $(this.target).children().removeClass("tree-checkbox");
                })
            });
        },
        onBeforeDrag:function(node){
            if($("#caseViewTree").tree("getParent",node.target))
                return false;
           
        },
        onDragOver:function(target, source){
            if($("#caseViewTree").tree("getParent",target))
                return false;
        }
    });

    function caseViewSave()
    {
        var nodes= $('#caseViewTree').tree("getRoots");
        var steps=[];
        
        var n;
        for (n in nodes )
        {
            var step = {};
            var node = nodes[n];
            var p = {};
            for (c in node.children)
            {
                var child = node.children[c];
                p[child.Key] = child.Value;
            }

            step["ParamBinding"] = p;
            steps.push(step);
        }
    }
    

    </script>